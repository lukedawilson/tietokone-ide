@using StackExchange.StacksIcons

<nav>
  <div class="s-navigation bg-purple-100">
    <button disabled id="run" type="button" class="s-navigation--item fc-green-300" onclick="onRunClicked()">@Svg.Play</button>
  </div>
</nav>

<golden-layout-widgets>
  <code-mirror-editor data-name="editor" data-title="JavaScript" onUpdate="document.getElementById('run').disabled = !value"></code-mirror-editor>
  <div id="output"
       class="p16 bg-black-050"
       style="width: 100%; height: calc(100% - 100px); top: 50px; color: limegreen; overflow: auto"
       readonly="readonly"
       data-name="output"
       data-title="Output">
  </div>
</golden-layout-widgets>

<script>
  function onRunClicked() {
    const editor = document.querySelector('code-mirror-editor').editorView;
    const code = editor.viewState.state.doc.toString();
    const run = new Function(code);

    const consoleLog = console.log
    const output = document.getElementById('output');
    output.innerHTML = '';
    console.log = (...args) => {
      output.innerHTML += `${args.join(' ')}<br/>`;
      output.scrollTop = output.scrollHeight;
    }

    try {
      run();
      console.log();
      console.log('Execution complete.');
    } catch (e) {
      console.log(e);
    } finally {
      console.log = consoleLog;
    }
  }
</script>
